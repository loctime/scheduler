// ========= HORARIOS SCHEDULER =========

// Colección: apps/horarios/users
match /apps/horarios/users/{userId} {
  // Solo el usuario puede leer/escribir su propio documento
  allow read, write: if isAuth() && userId == uid();
  // No permitir eliminar usuarios
  allow delete: if false;
  // En update: proteger que no se cambie el uid
  allow update: if isAuth() && userId == uid() && unchanged('uid');
}

// Colección: apps/horarios/employees
match /apps/horarios/employees/{empleadoId} {
  // Solo el dueño puede leer
  allow read: if isAuth() && resource.data.userId == uid();
  // Crear: verificar que userId sea correcto
  allow create: if isAuth() && request.resource.data.userId == uid();
  // Actualizar: verificar propiedad y proteger userId
  allow update: if isAuth() && resource.data.userId == uid()
    && (!('userId' in request.resource.data) || request.resource.data.userId == resource.data.userId);
  // Eliminar: solo el dueño
  allow delete: if isAuth() && resource.data.userId == uid();
}

// Colección: apps/horarios/shifts
match /apps/horarios/shifts/{turnoId} {
  // Solo el dueño puede leer
  allow read: if isAuth() && resource.data.userId == uid();
  // Crear: verificar que userId sea correcto
  allow create: if isAuth() && request.resource.data.userId == uid();
  // Actualizar: verificar propiedad y proteger userId
  allow update: if isAuth() && resource.data.userId == uid()
    && (!('userId' in request.resource.data) || request.resource.data.userId == resource.data.userId);
  // Eliminar: solo el dueño
  allow delete: if isAuth() && resource.data.userId == uid();
}

// Colección: apps/horarios/schedules
match /apps/horarios/schedules/{horarioId} {
  // Solo el dueño puede leer
  allow read: if isAuth() && resource.data.createdBy == uid();
  // Crear: verificar que createdBy sea correcto
  allow create: if isAuth() && request.resource.data.createdBy == uid();
  // Actualizar: verificar propiedad y proteger createdBy
  allow update: if isAuth() && resource.data.createdBy == uid()
    && (!('createdBy' in request.resource.data) || request.resource.data.createdBy == resource.data.createdBy);
  // Eliminar: solo el dueño
  allow delete: if isAuth() && resource.data.createdBy == uid();
}

// Colección: apps/horarios/historial
match /apps/horarios/historial/{historialId} {
  // Solo el dueño puede leer
  allow read: if isAuth() && resource.data.createdBy == uid();
  // Crear: verificar que createdBy sea correcto
  allow create: if isAuth() && request.resource.data.createdBy == uid();
  // Historial es inmutable
  allow update: if false;
  // Eliminar: solo el dueño
  allow delete: if isAuth() && resource.data.createdBy == uid();
}

// Colección: apps/horarios/config
match /apps/horarios/config/{configId} {
  // Cada usuario solo puede leer/editar su propia configuración (configId debe ser su uid)
  allow read, write: if isAuth() && configId == uid();
  // No permitir eliminar configuración
  allow delete: if false;
}

